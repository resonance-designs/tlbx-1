import { Theme } from "../theme/index.slint";
import { RDSHeaderLabel, RDSCircleToggle, RDSComboBox, RDSSimpSlider } from "../components/index.slint";

/*
Device: G8
Description: 32-step trance gate with per-step level bars and quantized rate.
*/
export component G8Device {
    in property <length> bar-width: 12px;
    in property <length> bar-spacing: 4px;
    in-out property <bool> gate-enabled: true;
    in-out property <int> gate-rate-index: 0;
    in property <[string]> gate-rate-options: ["1", "1/2", "1/4", "1/8", "1/16"];
    in-out property <[float]> gate-steps: [
        1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
        1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
        1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
        1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0
    ];

    callback toggle-gate-enabled();
    callback gate-rate-selected(index: int);
    callback gate-step-changed(index: int, value: float);

    VerticalLayout {
        spacing: 8px;

        RDSHeaderLabel {
            text: "G8 Trance Gate";
            horizontal-alignment: left;
            padding-horizontal: 12px;
            padding-vertical: 6px;
            right-padding: 12px;
            HorizontalLayout {
                spacing: 8px;
                alignment: center;
                Text {
                    text: "Rate";
                    color: #b9b9bf;
                    font-size: 11px;
                }
                RDSComboBox {
                    width: 90px;
                    height: 22px;
                    model: root.gate-rate-options;
                    current-index: root.gate-rate-index;
                    selected => {
                        root.gate-rate-index = self.current-index;
                        root.gate-rate-selected(self.current-index);
                    }
                }
                RDSCircleToggle {
                    active: root.gate-enabled;
                    label: "Bypass";
                    label-active: "On";
                    label-pos: "left";
                    label-color: #b9b9bf;
                    label-active-color: Theme.active.text_primary;
                    label-font-size: 11px;
                    label-font-weight: 500;
                    clicked => root.toggle-gate-enabled();
                }
            }
        }

        Rectangle {
            background: #1e3a5f33;
            border-width: 2px;
            border-radius: 6px;
            border-color: Theme.active.border-strong;
            height: 140px;
            clip: true;

            HorizontalLayout {
                padding-top: 10px;
                padding-right: 10px;
                padding-bottom: 10px;
                padding-left: 10px;
                spacing: root.bar-spacing;
                alignment: center;

                for s in 32 : RDSSimpSlider {
                    slider-width: root.bar-width;
                    slider-height: parent.height;
                    orientation: "vertical";
                    value: root.gate-steps[s];
                    min-value: 0.0;
                    max-value: 1.0;
                    background-color: Theme.active.background_raised;
                    fill-color: Theme.active.accent_secondary;
                    border-clr: Theme.active.border_subtle;
                    border-size: 1px;
                    radius: 4px;
                    value-changed(v) => {
                        root.gate-steps[s] = v;
                        root.gate-step-changed(s, v);
                    }
                }
            }
        }
    }
}

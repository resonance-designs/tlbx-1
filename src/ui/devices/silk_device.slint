import { Theme } from "../theme/index.slint";
import { RDSKnob, RDSHeaderLabel, RDSCircleToggle } from "../components/index.slint";

export component SilkDevice {
    in-out property <bool> ring-enabled: false;
    in-out property <float> ring-cutoff: 0.5;
    in-out property <float> ring-resonance: 0.0;
    in-out property <float> ring-decay: 0.0;
    in-out property <float> ring-pitch: 0.5;
    in property <[string]> ring-decay-modes;
    in-out property <int> ring-decay-mode: 0;
    in-out property <float> ring-slope: 0.5;
    in-out property <float> ring-tone: 0.5;
    in-out property <float> ring-tilt: 0.5;
    in-out property <float> ring-wet: 0.0;
    in-out property <float> ring-detune: 0.0;
    in-out property <float> ring-waves: 0.0;
    in-out property <float> ring-waves-rate: 0.5;
    in-out property <float> ring-noise: 0.0;
    in-out property <float> ring-noise-rate: 0.5;
    in-out property <bool> ring-pre-post: true;

    callback toggle-ring-enabled();
    callback toggle-ring-pre-post();
    callback ring-cutoff-changed(value: float);
    callback ring-resonance-changed(value: float);
    callback ring-decay-changed(value: float);
    callback ring-pitch-changed(value: float);
    callback ring-decay-mode-selected(index: int);
    callback ring-slope-changed(value: float);
    callback ring-tone-changed(value: float);
    callback ring-tilt-changed(value: float);
    callback ring-wet-changed(value: float);
    callback ring-detune-changed(value: float);
    callback ring-waves-changed(value: float);
    callback ring-waves-rate-changed(value: float);
    callback ring-noise-changed(value: float);
    callback ring-noise-rate-changed(value: float);

    // Device Container
    VerticalLayout {
        spacing: 8px;

        // Device Name
        RDSHeaderLabel {
            text: "Ring";
            horizontal-alignment: left;
            padding-horizontal: 12px;
            padding-vertical: 6px;
            right-padding: 12px;
            HorizontalLayout {
                spacing: 6px;
                alignment: center;
                RDSCircleToggle {
                    active: root.ring-enabled;
                    label: "Bypass";
                    label-active: "On";
                    label-pos: "left";
                    label-color: #b9b9bf;
                    label-active-color: Theme.active.text_primary;
                    label-font-size: 11px;
                    label-font-weight: 500;
                    clicked => root.toggle-ring-enabled();
                }
                RDSCircleToggle {
                    active: root.ring-pre-post;
                    label: "Post";
                    label-active: "Pre";
                    label-pos: "left";
                    label-color: #b9b9bf;
                    label-active-color: Theme.active.text_primary;
                    label-font-size: 11px;
                    label-font-weight: 500;
                    clicked => root.toggle-ring-pre-post();
                }
            }
        }

        // Device Controls
        Rectangle {
            background: #1e3a5f33;
            border-width: 2px;
            border-radius: 6px;
            border-color: Theme.active.border-strong;
            GridLayout {
                padding-top: 30px;
                padding-right: 12px;
                padding-bottom: 12px;
                padding-left: 12px;
                spacing-horizontal: 10px;
                spacing-vertical: 30px;

                // Row 1 Controls
                Row {
                    // Wet
                    RDSKnob {
                        renderer: "lo-fi";
                        value: root.ring-wet;
                        min-value: 0; max-value: 1;
                        size: 70px; indicator-position: 25px;
                        label: "Wet";
                        label-pos: "top-center";
                        label-font-size: 10px;
                        label-font-weight: 500;
                        sensitivity: 0.01; scroll-sensitivity: 0.01;
                        value-changed(v) => { root.ring-wet = v; root.ring-wet-changed(v); }
                    }
                    // Cutoff
                    RDSKnob {
                        renderer: "lo-fi";
                        value: root.ring-cutoff;
                        min-value: 0; max-value: 1;
                        size: 70px; indicator-position: 25px;
                        label: "Cutoff";
                        label-pos: "top-center";
                        label-font-size: 10px;
                        label-font-weight: 500;
                        sensitivity: 0.01; scroll-sensitivity: 0.01;
                        value-changed(v) => { root.ring-cutoff = v; root.ring-cutoff-changed(v); }
                    }
                    // Resonance
                    RDSKnob {
                        renderer: "lo-fi";
                        value: root.ring-resonance;
                        min-value: 0; max-value: 1;
                        size: 70px; indicator-position: 25px;
                        label: "Res";
                        label-pos: "top-center";
                        label-font-size: 10px;
                        label-font-weight: 500;
                        sensitivity: 0.01; scroll-sensitivity: 0.01;
                        value-changed(v) => { root.ring-resonance = v; root.ring-resonance-changed(v); }
                    }
                    // Pitch
                    RDSKnob {
                        renderer: "lo-fi";
                        value: root.ring-pitch;
                        min-value: 0; max-value: 1;
                        size: 70px; indicator-position: 25px;
                        label: "Pitch";
                        label-pos: "top-center";
                        label-font-size: 10px;
                        label-font-weight: 500;
                        sensitivity: 0.01; scroll-sensitivity: 0.01;
                        value-changed(v) => { root.ring-pitch = v; root.ring-pitch-changed(v); }
                    }
                    // Tone
                    RDSKnob {
                        renderer: "lo-fi";
                        value: root.ring-tone;
                        min-value: 0; max-value: 1;
                        size: 70px; indicator-position: 25px;
                        label: "Tone";
                        label-pos: "top-center";
                        label-font-size: 10px;
                        label-font-weight: 500;
                        sensitivity: 0.01; scroll-sensitivity: 0.01;
                        value-changed(v) => { root.ring-tone = v; root.ring-tone-changed(v); }
                    }
                    // Tilt
                    RDSKnob {
                        renderer: "lo-fi";
                        value: root.ring-tilt;
                        min-value: 0; max-value: 1;
                        size: 70px; indicator-position: 25px;
                        label: "Tilt";
                        label-pos: "top-center";
                        label-font-size: 10px;
                        label-font-weight: 500;
                        sensitivity: 0.01; scroll-sensitivity: 0.01;
                        value-changed(v) => { root.ring-tilt = v; root.ring-tilt-changed(v); }
                    }
                    // Slope
                    RDSKnob {
                        renderer: "lo-fi";
                        value: root.ring-slope;
                        min-value: 0; max-value: 1;
                        size: 70px; indicator-position: 25px;
                        label: "Slope";
                        label-pos: "top-center";
                        label-font-size: 10px;
                        label-font-weight: 500;
                        sensitivity: 0.01; scroll-sensitivity: 0.01;
                        value-changed(v) => { root.ring-slope = v; root.ring-slope-changed(v); }
                    }
                }

                // Row 2 Controls
                Row {
                    // Decay
                    RDSKnob {
                        renderer: "lo-fi";
                        value: root.ring-decay;
                        min-value: 0; max-value: 1;
                        size: 70px; indicator-position: 25px;
                        label: "Decay";
                        label-pos: "top-center";
                        label-font-size: 10px;
                        label-font-weight: 500;
                        sensitivity: 0.01; scroll-sensitivity: 0.01;
                        value-changed(v) => { root.ring-decay = v; root.ring-decay-changed(v); }
                    }
                    // Decay Mode
                    RDSKnob {
                        renderer: "lo-fi";
                        value: root.ring-decay-mode;
                        min-value: 0; max-value: 1;
                        size: 70px; indicator-position: 25px;
                        label: "Dec Mode";
                        label-pos: "top-center";
                        label-font-size: 10px;
                        label-font-weight: 500;
                        readout-mode: "literal";
                        readout-literals: ["Sustain", "Choke"];
                        sensitivity: 0.01; scroll-sensitivity: 0.01;
                        value-changed(v) => {
                            let mode = v >= 0.5 ? 1 : 0;
                            root.ring-decay-mode = mode;
                            root.ring-decay-mode-selected(mode);
                        }
                    }
                    // Detune
                    RDSKnob {
                        renderer: "lo-fi";
                        value: root.ring-detune;
                        min-value: 0; max-value: 1;
                        size: 70px; indicator-position: 25px;
                        label: "Detune";
                        label-pos: "top-center";
                        label-font-size: 10px;
                        label-font-weight: 500;
                        sensitivity: 0.01; scroll-sensitivity: 0.01;
                        value-changed(v) => { root.ring-detune = v; root.ring-detune-changed(v); }
                    }
                    // Waves
                    RDSKnob {
                        renderer: "lo-fi";
                        value: root.ring-waves;
                        min-value: 0; max-value: 1;
                        size: 70px; indicator-position: 25px;
                        label: "Waves";
                        label-pos: "top-center";
                        label-font-size: 10px;
                        label-font-weight: 500;
                        sensitivity: 0.01; scroll-sensitivity: 0.01;
                        value-changed(v) => { root.ring-waves = v; root.ring-waves-changed(v); }
                    }
                    // Wave Rate
                    RDSKnob {
                        renderer: "lo-fi";
                        value: root.ring-waves-rate;
                        min-value: 0; max-value: 1;
                        size: 70px; indicator-position: 25px;
                        label: "W-Rate";
                        label-pos: "top-center";
                        label-font-size: 10px;
                        label-font-weight: 500;
                        sensitivity: 0.01; scroll-sensitivity: 0.01;
                        value-changed(v) => { root.ring-waves-rate = v; root.ring-waves-rate-changed(v); }
                    }
                    // Noise
                    RDSKnob {
                        renderer: "lo-fi";
                        value: root.ring-noise;
                        min-value: 0; max-value: 1;
                        size: 70px; indicator-position: 25px;
                        label: "Noise";
                        label-pos: "top-center";
                        label-font-size: 10px;
                        label-font-weight: 500;
                        sensitivity: 0.01; scroll-sensitivity: 0.01;
                        value-changed(v) => { root.ring-noise = v; root.ring-noise-changed(v); }
                    }
                    // Noise Rate
                    RDSKnob {
                        renderer: "lo-fi";
                        value: root.ring-noise-rate;
                        min-value: 0; max-value: 1;
                        size: 70px; indicator-position: 25px;
                        label: "N-Rate";
                        label-pos: "top-center";
                        label-font-size: 10px;
                        label-font-weight: 500;
                        sensitivity: 0.01; scroll-sensitivity: 0.01;
                        value-changed(v) => { root.ring-noise-rate = v; root.ring-noise-rate-changed(v); }
                    }
                }
            }
        }
    }
}
